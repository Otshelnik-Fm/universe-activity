== Установка/Обновление ==

<h3 style="text-align: center;">Установка:</h3>
Т.к. это дополнение для WordPress плагина <a href="https://codeseller.ru/groups/plagin-wp-recall-lichnyj-kabinet-na-wordpress/" target="_blank">WP-Recall</a>, то оно устанавливается через <a href="https://codeseller.ru/obshhie-svedeniya-o-dopolneniyax-wp-recall/" target="_blank"><strong>менеджер дополнений WP-Recall</strong></a>.

1. В админке вашего сайта перейдите на страницу "WP-Recall" -> "Дополнения" и в самом верху нажмите на кнопку "Обзор", выберите .zip архив дополнения на вашем пк и нажмите кнопку "Установить".
2. В списке загруженных дополнений, на этой странице, найдите это дополнение, наведите на него курсор мыши и нажмите кнопку "Активировать". Или выберите чекбокс и в выпадающем списке действия выберите "Активировать". Нажмите применить.


<h3 style="text-align: center;">Обновление:</h3>
Дополнение поддерживает <a href="https://codeseller.ru/avtomaticheskie-obnovleniya-dopolnenij-plagina-wp-recall/" target="_blank">автоматическое обновление</a> - два раза в день отправляются вашим сервером запросы на обновление.
Если в течении суток вы не видите обновления (а на странице дополнения вы видите что версия вышла новая), советую ознакомиться с этой <a href="https://codeseller.ru/post-group/rabota-wordpress-krona-cron-prinuditelnoe-vypolnenie-kron-zadach-dlya-wp-recall/" target="_blank">статьёй</a>



== Логика/Настройки ==

= Список регистрируемых событий и логика: =
    * Пишет когда пользователь залогинился через ВП
    * Когда юзер залогинился через плагин uLogin и какая сеть
    * когда зарегистрировался
    * если в WP-Recall стоит подтверждение регистрации - то запишет как ее подтвердит
    * неверная регистрация и причина
    * выход с сайта
    * при удалении юзера - запишем кто удалил его и очистим историю удаленного юзера
    * обновил настройки профиля
    * поставил рейтинг за:
        <code>&nbsp;&nbsp;&nbsp;Проголосовал -10 за запись: для фида 2 без море</code>
    * если это товар:
        <code>&nbsp;&nbsp;&nbsp;Проголосовал +10 за товар: Кот в мешке</code>
    * оставил комментарий:
        <code>&nbsp;&nbsp;&nbsp;Оставил комментарий к записи: "для фида 2 без море"</code>
    * если это комментарий к записе в группе - то выводит и название группы:
        <code>&nbsp;&nbsp;&nbsp;Оставил комментарий к записи: "Я вижу как закат стёкла оконные плавит…" в группе "Скрытые возможности Теней!"</code>
        &nbsp;&nbsp;&nbsp;ссылка будет короткой и ведет к самому комментарию и имя группы - ссылка на группу
    * если это комментарий к товару то и пишем:
        <code>&nbsp;&nbsp;&nbsp;Оставил комментарий к товару: "Продам робота"</code>
    * статус комментария, если он отличается от опубликованного, учитывается. И ссылка на коммент не выводится
    * при удалении комментария - удаляется он из таблицы
    * опубликовал запись:
        &nbsp;&nbsp;&nbsp;если модерации нет
        &nbsp;&nbsp;&nbsp;если модерация есть - пишется время и статус (add_post), но ссылка на запись не видна. Видна лишь тем кто имеет право редактировать запись (сам автор, редакторы и админ)
        &nbsp;&nbsp;&nbsp;если админ одобрил ее - время публикации не меняется, появляется ссылка на нее
    * убрал ее в черновики
    * удалил запись
    * полное удаление записи с сайта (очистил корзину или если корзина отключена, т.е. когда запись удаляется безвозвратно)
        &nbsp;&nbsp;&nbsp;если полное удаление записи - чистим всю историю по нему, кроме факта (строки) полного удаления
    * ловим когда при сохранении настроек меняют статус. Фиксируем это. При повторной смене статуса - время смены статуса переписывается
    * подписался на пользователя, отписался от него
        &nbsp;&nbsp;&nbsp;если юзер начинает тыкать подписаться/отписаться я стираю при подписке эти два поля и фиксирую новое событие. Избавляемся от дублей
    * добавление и удаление юзеров в черный список
        &nbsp;&nbsp;&nbsp;логика работы как у подписок - исключая тыканье добавить/убрать из блеклиста
    * добавлен в отдельный пункт (item) css класс определяющий что за тип данных выводится - <a href="https://yadi.sk/i/oWgYPnmR3KJutL" target="_blank">скриншот</a> - так вы можете кастомизировать отдельное событие и обыграть стилями
    * ловим создание новой группы
    * удаление группы (админка)
        &nbsp;&nbsp;&nbsp;при удалении группы на строчку созданной группы вешаем маркер del - и наша система не будет на нее давать ссылку
    * ввел короткие ссылки для комментариев и для групп и для форума (Prime-Forum) - это значительно сократило кол-во запросов к бд
    * вступил в группу/покинул ее
    * создал тему на Prime-Forum
        &nbsp;&nbsp;&nbsp;ссылка на топик формируется короткая - меньше запросов к бд
    * удалил тему с форума. Если тему удаляет не сам автор - то пишу чья тема была удалена

------------------------------

= События и привилегии: =

Дополнение позволяет разным типам пользователей видеть разные события. Так что все события видит только админ, а гость видит минимум - у него есть мотивация зарегистрироваться или войти на сайт чтобы видет больше событий.  
Ниже список все объясняет.  

= Привилегии: =
<code>Гость</code> - пользователь не вошедший на сайт. Если у события нет привилегии доступа - значит видно всем, начиная с гостя. 
<code>Залогинен</code> - 'logged' 
<code>Автор</code> (в своем ЛК - это если передан атрибут шорткода include_users="author_lk") - 'logged' и 'author' 
<code>Админ</code> - 'logged', 'author', 'admin' 

<strong>События:</strong>

<strong>Гость видит:</strong>
 
add_comment (добавлен комментарий) 
add_post (добавлена запись) 
change_status (юзер сменил свой статус) 
give_rating_comment (рейтинг за комментарий) 
give_rating_notes (рейтинг за заметку) 
give_rating_post (рейтинг за запись - тип post) 
give_rating_post-group (рейтинг за запись в группе - тип post-group) 
give_rating_products (рейтинг за товар - тип products) 
add_user_feed (подписался на юзера) 
create_group (создал группу) 
user_in_group (юзер вступил в группу) 
pfm_add_topic (создана новая тема на prime-forum) 


= Залогиненый видит: те что выше, плюс: =

add_draft (добавил черновик) 
confirm_register (подтвердил регистрацию) 
register (зарегистрировался) 
del_user_feed (отписался от юзера) 
add_user_blacklist (добавил в черный список) 
del_user_blacklist (удалил из черного списка) 
user_out_group (вышел из группы) 

= Автор видит: все что выше, плюс: =

logged_in (когда он вошел на сайт) 
logged_in_ulogin (когда он вошел через u-login и через какую сеть) 
logged_out (когда он вышел с сайта)  

= Админ видит: все что выше, плюс: =

delete_post (удалил запись - в корзину) 
delete_post_fully (удалил запись навсегда. Если это автоочистка корзины - пишет "wp-cron") 
delete_user (удалил юзера) 
profile_update (обновил настройки профиля) 
register_failed (неудачная регистрация) 
delete_group (удалил группу) 
pfm_del_topic (удалил тему с форума)

------------------------------

= Шорткод: =
Дополнение автоматически ничего нигде не выводит. За исключением поддержки дополнения <a href="https://codeseller.ru/products/user-info-tab/" target="_blank">User Info Tab</a> - но без постраничной навигации (там выводит последние 30 событий пользователя)  
(чтобы у User Info Tab была постраничная навигация нужно поставить дополнение <strong>Universe Activity Extended</strong>)  

Итак - всё выводим с помощью шорткода: <code>[otfm_universe filter=1]</code>

= Дополнительные атрибуты шорткода: =

<strong>filter</strong> - показывать фильтр. Поставьте "1" чтобы выводить сверху фильтр по событиям (по умолчанию 0)  
<strong>number</strong> - количество событий на странице (по умолчанию 30). Поставьте "-1" чтобы вывести все. Для постраничной навигации вам нужно дополнение <strong>Universe Activity Extended</strong>  
<strong>include_actions</strong> - включить эти события. Через запятую (события -slug- на английском смотрите выше в "Событиях и привилегиях").  
<strong>exclude_actions</strong> - исключить события (нельзя в атрибутах одновременно использовать include_actions и exclude_actions. Что-то одно)  
<strong>include_users</strong> - включая юзеров. Через запятую (id юзеров - число). В личном кабинете в произвольной вкладке WP-Recall допустимо вписать <code>author_lk</code> и система подставит туда id автора кабинета.  
<strong>class</strong> - css class главного блока (<a href="https://yadi.sk/i/f1OvpO_E3LmcZh" target="_blank">скриншот</a>). Например чтобы вы создали свой дизайн вывода. На основе этого атрибута уже подготовлено несколько значений:  
(если не указан - то дизайн будет самый минималистичный)  
<code>"una_zebra"</code> - простой зеброй  
<code>"una_basic"</code> - базовый  
<code>"una_modern"</code> - модерн стиль  

= Примеры: =
1. Выведем модерновый стиль, фильтр и 40 записей:  
<code>[otfm_universe class="una_modern" number="40" filter=1]</code>

2. Выведем, создав в админке вашего сайта: "WP-Recall" -> "Менеджер вкладок" - вкладку в ЛК, чтобы она показывала только события автора кабинета:  
<code>[otfm_universe filter=1 include_users="author_lk"]</code>

3. Выведем все события: комментарии и рейтинг за них. Без фильтра сверху:  
<code>[otfm_universe class="una_basic" number="-1" include_actions="add_comment,give_rating_comment"]</code>

4. Выведем все рейтинги и стилизуем базовым стилем:  
<code>[otfm_universe class="una_basic" include_actions="give_rating_comment,give_rating_notes,give_rating_post,give_rating_post-group,give_rating_products"]</code>

------------------------------

= Какие события включены в фильтр: =
<strong>"Публикации"</strong> - add_post  
<strong>"Комментарии"</strong> - add_comment  
<strong>"Рейтинг"</strong> - give_rating_comment,give_rating_notes,give_rating_post,give_rating_post-group,give_rating_products  
<strong>"Обновления"</strong> - change_status,profile_update,create_group,user_in_group,pfm_add_topic  
<strong>"Подписки"</strong> - add_user_feed  





== FAQ ==

= Установил дополнение - не вижу ничего =
- Нужно вывести шорткодом. Смотри описание шорткода в вкладке "Логика/Настройки" и конечно же должно быть записано хоть одно событие в базу - админ видит их все.  
  
  
= Я вижу не все события из последних. Некоторые скрыты =
- У дополнения есть система событий и привилегий. Читай в вкладке "Логика/Настройки" - <strong>"События и привилегии"</strong>
  
  
= Установил, вывел. Пишет счетчик: событий 100, но я вижу только 30 =
- По умолчанию и выводит 30. Нужно вывести все - ставь в атрибут шорткода <code>number="-1"</code>. Нужна постраничная навигация ставь дополнение <strong>Universe Activity Extended</strong> (читай пункт <strong>"Ограничения"</strong> в вкладке "Описание")  
  
  
= Как вывести активность пользователя в его личном кабинете? =
- Читай в вкладке "Логика/Настройки" <strong>"Шорткод"</strong>. Второй пример.  
  
  
= Вывел фильтр - но я не вижу рейтинг и подписки =
- Дополнения "Rating System (Система рейтинга)" и "Feed (Подписки)" должны быть у вас активны
  
  
= А в какой таблице в базе данных хранятся события? =
- Смотрите таблицу: <strong>wp_otfm_universe_activity</strong>
  
  
= Удалив это дополнение я потеряю данные о активности? =
- При удалении дополнения через менеджер дополнений - он за собой удалит свою таблицу, в которой он хранит пользовательскую активность.  




== Changelog ==

= 2017-08-07 =
v0.6  
* ООП  
* Исправление уведомлений уровня notice  
* Исправлены найденные баги  
* Пагинация, плавающий блок даты, плавное доведение до верха блока - это отделилось в стороннее решение <strong>Universe Activity Extended</strong>
* Пункт выше - т.к. я ядро (сам доп "Universe Activity") решил распространять бесплатно.  
Мотив простой - базовая версия самодостаточна и ее можно использовать как фреймворк. А бесплатное распространение позволит охватить максимум аудитории и сделать базу еще крепче и гибче.  
Отдельными дополнениями будет наращиваться к ней функционал - кому-то нужный (возьмет), а кому дополнительно обвязка не нужна - не будет нагружать сервак.  

= 2017-08-03 =
v0.5  
* вывел фильтры  
* переработал стили  
* добавил новые атрибуты в шорткод  

= 2017-07-11 =
v0.4  
* ajax пагинация на странице вывода шорткодом.  
* плавное доведение блока вверх.  

= 2017-07-07 =
v0.3  
* Постраничная навигация (пагинация) - возможно установить свое кол-во для вывода, или если -1 - выведет все.  

= 2017-07-06 =
v0.2  
* Использование класса <a href="https://codeseller.ru/post-group/rcl_query-udobnyj-klass-dlya-postroeniya-zaprosov-k-bd-ot-wp-recall/" target="_blank">Rcl_Query</a> от WP-Recall  
* На данный момент дополнение позволяет выводить шорткодом данные:  
1. Указать id пользователей которых выводить, или наоборот - которых исключить.  
2. Позволяет указать конкретные действия которые выводить, или наоборот - какие исключить. Поддерживая при этом приватность в зависимости от привилегий пользователя.  
3. Позволяет установить сколько элементов на страницу выводить (для постраничной навигации, ее пока нет еще)  
4. Позволяет установить в шорткоде класс которым будет оборачиваться главный блок - это вам позволит каждый шорткод, к примеру, стилизовать по своему.  
Я подготовил другой внешний вид - как пример возможностей.  

= 2017-05-28 =
v0.007  
* Идея, проектирование бд и первый код.  



== Прочее ==

* Поддержка осуществляется в рамках текущего функционала дополнения
* При возникновении проблемы, создайте соотвествующую тему на <a href="https://codeseller.ru/forum/product-15611/" target="_blank">форуме поддержки</a> товара
* Если вам нужна доработка под ваши нужды - вы можете обратиться ко мне в <a href="https://codeseller.ru/author/otshelnik-fm/?tab=chat" target="_blank">ЛС</a> с техзаданием на платную доработку.

Полный список моих работ опубликован <a href="http://across-ocean.otshelnik-fm.ru/" target="_blank">на моем демо-сайте</a> и в каталоге магазина <a href="https://codeseller.ru/author/otshelnik-fm/?tab=publics&subtab=type-products" target="_blank">CodeSeller.ru</a>
